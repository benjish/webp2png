const Webp2PngSWClient=(e,t)=>{let n=!t&&void 0,r=null;const s=[],o=[];new Promise(e=>{if(t)return e(!1);const n=sessionStorage.getItem("webp2png_native");if(n)return e("true"===n);const r=new Image;r.onload=()=>e(r.width>0&&r.height>0),r.onerror=()=>e(!1),r.src="data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA=="}).then(e=>{let t;for(n=e,sessionStorage.setItem("webp2png_native",e?"true":"false");t=o.shift();)t(e)});const a=()=>void 0!==n?Promise.resolve(n):new Promise(e=>o.push(e)),c=()=>{r&&r.postMessage({cmd:"webp2png-clientDisconnect"})};return(async()=>{if(await a()||"object"==typeof self.Webp2Png)return Promise.resolve();return e?new Promise((t,n)=>{const r=document.createElement("script");r.src=e,r.onload=()=>{(()=>{let e;for(;e=s.shift();)e.res()})(),t()},r.onerror=e=>{((e,t)=>{let n;for(;n=s.shift();)n.rej(t)})(),n(e)},document.body.appendChild(r)}):(c(),Promise.reject("Webp2Png API undefined"))})().catch(e=>console.error(e)),{isWebpReady:a,applySWUrl:async e=>{e.startsWith("/")&&(e=location.origin+e);const t=new URL(e);return await a()?t.searchParams.delete("webp2png"):t.searchParams.set("webp2png","true"),t.href},serviceWorkerHandler:async(e,t)=>{if(r=e,await a())return;if(t)return c(),void document.location.reload();const n=new MessageChannel;n.port1.onmessage=async t=>{const n=t.data;if(n.cmd)switch(n.cmd){case"webp2png-convert":try{n.data=await(e=>"object"==typeof self.Webp2Png?self.Webp2Png.toArrayBuffer(e):new Promise((t,n)=>{s.push({res:async()=>{"object"!=typeof self.Webp2Png&&n("Webp2Png not loaded");try{t(await self.Webp2Png.toArrayBuffer(e))}catch(e){n(e)}},rej:n})}))(n.data),n.cmd="webp2png-response",e.postMessage(n)}catch(t){n.error=!0,delete n.data,e.postMessage(n),console.error(t)}}},window.addEventListener("beforeunload",c),e.postMessage({cmd:"webp2png-clientConnect"},[n.port2])},disconnectSW:c}};
